<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Algoritmos para sistemas de ecuaciones</title>
    <style>
        :root {
            --bg: #0a0f1a;
            --ink: #ecf3ff;
            --muted: #9fb2d8;
            --stroke: #223255;
            --card: #0f1a2d;
            --panel: #0d1627;
            --hi: #5BE0B3;
            --hi-2: #7cc4ff;
            --warn: #ffd166;
            --err: #ff6b6b;
            --shadow: 0 14px 36px rgba(0,0,0,.45);
            --r: 18px;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            color: var(--ink);
            background: radial-gradient(1200px 600px at 10% -10%,#122342 0%,transparent 60%), radial-gradient(1200px 600px at 110% 10%,#0e1e3b 0%,transparent 60%), linear-gradient(#09101c,#070d17);
            font: 500 15px/1.4 "Inter",system-ui,Segoe UI,Roboto,Arial
        }

        .wrap {
            max-width: 1200px;
            margin: auto;
            padding: 28px
        }

        .brand {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px
        }

        .badge {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: var(--hi);
            display: grid;
            place-items: center;
            color: #0a0f1a;
            font-weight: 900;
            box-shadow: var(--shadow)
        }

        .subtitle {
            color: var(--muted);
            font-size: 13px
        }

        .status {
            color: var(--muted);
            font-size: 13px
        }

        .spin {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid #1f3358;
            border-top-color: var(--hi);
            display: none;
            margin-left: 8px;
            animation: spin .9s linear infinite
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .grid {
            display: grid;
            grid-template-columns: 1.35fr .9fr;
            gap: 24px
        }

        @media (max-width:980px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .card {
            background: var(--card);
            border: 1px solid var(--stroke);
            border-radius: var(--r);
            box-shadow: var(--shadow)
        }

        .head {
            padding: 18px 18px 0
        }

        .title {
            margin: 0;
            font-weight: 900;
            font-size: clamp(20px,3vw,28px)
        }

        .body {
            padding: 18px
        }

        .foot {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding: 0 18px 18px
        }

        .toolbar {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 12px
        }

        .inp {
            background: #0a1426;
            border: 1px solid var(--stroke);
            color: var(--ink);
            padding: 10px 12px;
            border-radius: 12px;
            outline: none;
            min-width: 110px
        }

            .inp:focus {
                border-color: var(--hi);
                box-shadow: 0 0 0 3px rgba(91,224,179,.18)
            }

        .btn {
            appearance: none;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            cursor: pointer;
            background: var(--hi);
            color: #08131f;
            font-weight: 900;
            box-shadow: var(--shadow)
        }

            .btn.ghost {
                background: transparent;
                color: var(--ink);
                border: 1px solid var(--stroke)
            }

            .btn:disabled {
                opacity: .6;
                cursor: not-allowed
            }

        .methods {
            display: grid;
            grid-template-columns: repeat(2,minmax(200px,1fr));
            gap: 12px;
            width: 100%
        }

        .method {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 12px;
            border-radius: 14px;
            border: 1px solid var(--stroke);
            background: var(--panel);
            cursor: pointer;
            transition: .15s ease;
        }

            .method:hover {
                border-color: #2b4274
            }

            .method.active {
                border-color: transparent;
                background: linear-gradient(180deg,#0e2341,#0d1f38);
                box-shadow: 0 0 0 2px rgba(124,196,255,.18) inset
            }

        .m-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            color: #0b1325;
            background: #173057;
            border: 1px solid #27477f
        }

        .method.active .m-icon {
            background: linear-gradient(180deg,#7cc4ff,#6aa7ff);
            color: #0a1120;
            border: none
        }

        .m-title {
            font-weight: 800
        }

        .board {
            margin-top: 14px;
            border: 1px dashed #27477f;
            border-radius: 14px;
            padding: 14px;
            background: linear-gradient(180deg,#0c172c,#0c182f)
        }

        .row {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(var(--n),minmax(80px,1fr)) 28px minmax(110px,1fr);
            align-items: center;
            margin: 10px 0
        }

        .eq {
            color: var(--muted);
            text-align: center
        }

        input.cell {
            width: 100%;
            padding: 12px 10px;
            border-radius: 12px;
            border: 1px solid var(--stroke);
            background: #0a1426;
            color: var(--ink);
            font-variant-numeric: tabular-nums
        }

            input.cell:focus {
                border-color: var(--hi-2);
                box-shadow: 0 0 0 3px rgba(124,196,255,.18)
            }

        .side {
            background: radial-gradient(120% 140% at 0% 0%,#132a54 0%,#0e1e3d 45%,#0c1830 100%);
            border: 1px solid var(--stroke);
            border-radius: var(--r);
            box-shadow: var(--shadow);
            padding: 20px
        }

            .side h3 {
                margin: 0 0 8px;
                color: #cddcff
            }

        .kv {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px 16px;
            margin-top: 10px
        }

        .k {
            color: #b9c8ee;
            font-family: ui-monospace,Consolas,Monaco,monospace
        }

        .v {
            color: var(--warn);
            font-weight: 900;
            font-family: ui-monospace,Consolas,Monaco,monospace;
            font-size: clamp(18px,3.4vw,28px)
        }

        .note {
            color: #9fb2d8;
            font-size: 13px;
            margin-top: 12px
        }

        .toast {
            position: fixed;
            right: 18px;
            bottom: 18px;
            background: #0c1c36;
            color: var(--ink);
            border: 1px solid var(--stroke);
            padding: 10px 12px;
            border-radius: 10px;
            display: none
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="brand">
            <div class="logo">
                <div class="badge">Mx</div>
                <div>
                    <div style="font-weight:900">Algoritmos para sistemas de ecuaciones</div>
                    <div class="subtitle">Cargá los coeficientes y resolvé con el método elegido</div>
                </div>
            </div>
            <div class="status">Estado: <span id="st">Listo</span><span id="spin" class="spin"></span></div>
        </div>

        <div class="grid">
            <!-- LEFT -->
            <section class="card">
                <div class="head">
                    <h2 class="title">Entrada de datos</h2>
                    <div class="toolbar">
                        <input id="dim" class="inp" type="number" min="2" max="12" value="3" />

                        <!-- ✅ NUEVOS CAMPOS ESTÉTICOS (no usados por JS/backend) -->
                        <input id="tol" class="inp" type="text" placeholder="Tolerancia" />
                        <input id="it" class="inp" type="text" placeholder="Iteraciones" />
                        <!-- ✅ FIN de la única modificación solicitada -->

                        <div class="methods" role="tablist" aria-label="Selector de método">
                            <div class="method active" id="mJordan" data-method="jordan" tabindex="0" role="tab" aria-selected="true">
                                <div class="m-icon">⟲</div>
                                <div><div class="m-title">Gauss-Jordan</div></div>
                            </div>
                            <div class="method" id="mSeidel" data-method="seidel" tabindex="0" role="tab" aria-selected="false">
                                <div class="m-icon">∞</div>
                                <div><div class="m-title">Gauss-Seidel</div></div>
                            </div>
                        </div>
                        <button id="gen" class="btn ghost">Generar</button>
                        <button id="solve" class="btn">Resolver</button>
                    </div>
                </div>
                <div class="body">
                    <div id="board" class="board" style="--n:3"></div>
                </div>
                <div class="foot">
                    <button id="clear" class="btn ghost">Limpiar</button>
                </div>
            </section>

            <!-- RIGHT -->
            <aside class="side">
                <h3>Resultados</h3>
                <div id="kv" class="kv"></div>
                <div id="meta" class="note"></div>
            </aside>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        (() => {
            const BASE_URL = "https://localhost:7026";
            const EP = { jordan: "/GaussJordan", seidel: "/GaussSeidel" };

            const dim = document.getElementById("dim");
            const board = document.getElementById("board");
            const gen = document.getElementById("gen");
            const solve = document.getElementById("solve");
            const clearBtn = document.getElementById("clear");
            const kv = document.getElementById("kv");
            const meta = document.getElementById("meta");
            const st = document.getElementById("st");
            const spin = document.getElementById("spin");
            const toast = document.getElementById("toast");
            const mJordan = document.getElementById("mJordan");
            const mSeidel = document.getElementById("mSeidel");

            let method = "jordan";

            const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
            const busy = b => { st.textContent = b ? "Calculando…" : "Listo"; spin.style.display = b ? "inline-block" : "none"; solve.disabled = b; }
            const toastMsg = t => { toast.textContent = t; toast.style.display = "block"; setTimeout(() => toast.style.display = "none", 2200); }
            const setMethod = key => {
                method = key;
                mJordan.classList.toggle("active", key === "jordan");
                mJordan.setAttribute("aria-selected", key === "jordan");
                mSeidel.classList.toggle("active", key === "seidel");
                mSeidel.setAttribute("aria-selected", key === "seidel");
            };

            function renderGrid(n) {
                board.style.setProperty("--n", n);
                board.innerHTML = "";
                for (let r = 0; r < n; r++) {
                    const row = document.createElement("div");
                    row.className = "row";
                    for (let c = 0; c < n; c++) {
                        const inp = document.createElement("input");
                        inp.type = "number"; inp.step = "any"; inp.className = "cell"; inp.placeholder = "0";
                        inp.dataset.r = r; inp.dataset.c = c;
                        row.appendChild(inp);
                    }
                    const eq = document.createElement("div"); eq.className = "eq"; eq.textContent = "="; row.appendChild(eq);
                    const rhs = document.createElement("input");
                    rhs.type = "number"; rhs.step = "any"; rhs.className = "cell"; rhs.placeholder = "0";
                    rhs.dataset.r = r; rhs.dataset.c = n; row.appendChild(rhs);
                    board.appendChild(row);
                }
            }
            function generate() {
                const n = clamp(parseInt(dim.value || "3", 10), 2, 12);
                dim.value = n;
                renderGrid(n);
                kv.innerHTML = ""; meta.textContent = "";
            }
            function readMatrix() {
                const n = board.children.length; if (n === 0) return null;
                const M = Array.from({ length: n }, () => Array(n + 1).fill(0));
                board.querySelectorAll("input.cell").forEach(inp => {
                    const r = +inp.dataset.r, c = +inp.dataset.c;
                    const v = inp.value.trim() === "" ? 0 : Number(inp.value);
                    if (Number.isNaN(v)) throw new Error("Valor no numérico (usá punto decimal).");
                    M[r][c] = v;
                });
                return M;
            }

            async function doSolve() {
                const matriz = readMatrix();
                if (!matriz) { toastMsg("Generá la grilla primero."); return; }
                const endpoint = EP[method];

                busy(true);
                try {
                    const res = await fetch((BASE_URL || "") + endpoint, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ matriz })
                    });

                    // Manejo de respuesta (igual que antes)
                    let data;
                    const ct = res.headers.get("content-type") || "";
                    if (ct.includes("application/json")) data = await res.json();
                    else data = await res.text();

                    if (!res.ok) {
                        const msg = (typeof data === "string" && data.trim())
                            ? data
                            : (data?.message || data?.title || "Error del servidor");
                        throw new Error(msg);
                    }
                    renderResult(data);
                } catch (err) {
                    toastMsg(err.message || "Error");
                } finally { busy(false); }
            }

            function renderResult(payload) {
                let sol = Array.isArray(payload) ? payload
                    : Array.isArray(payload.solucion) ? payload.solucion
                        : payload;
                if (!Array.isArray(sol)) { toastMsg("Respuesta inesperada"); return; }

                kv.innerHTML = "";
                sol.forEach((v, i) => {
                    const K = document.createElement("div"); K.className = "k"; K.textContent = `x${i + 1}`;
                    const V = document.createElement("div"); V.className = "v"; V.textContent = format(v);
                    kv.append(K, V);
                });
                meta.textContent = `• ${new Date().toLocaleTimeString()} · ${method === "jordan" ? "Gauss-Jordan" : "Gauss-Seidel"} · ${sol.length} variables`;
            }

            const format = n => !isFinite(n) ? String(n) : Number(n).toLocaleString("es-AR", { maximumFractionDigits: 10 });

            mJordan.addEventListener("click", () => setMethod("jordan"));
            mSeidel.addEventListener("click", () => setMethod("seidel"));
            mJordan.addEventListener("keydown", e => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); setMethod("jordan"); } });
            mSeidel.addEventListener("keydown", e => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); setMethod("seidel"); } });

            gen.addEventListener("click", generate);
            solve.addEventListener("click", doSolve);
            clearBtn.addEventListener("click", () => { board.querySelectorAll("input.cell").forEach(i => i.value = ""); kv.innerHTML = ""; meta.textContent = ""; });

            generate();
        })();
    </script>
</body>
</html>
